<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel Admina – Księga Gości</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-6">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-center">Życzenia i Media</h1>
    <div id="entries" class="space-y-6">
      <!-- Wpisy wstrzykiwane JS-em -->
    </div>
  </div>

  <!-- Ten sam modal co w index.html -->
  <div id="modal"
       class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden">
    <div class="relative max-w-full max-h-full">
      <button id="modalClose"
              class="absolute top-0 right-0 text-white text-3xl font-bold">&times;</button>
      <img id="modalImg" class="max-w-full max-h-full hidden rounded-md" />
      <video id="modalVideo" class="max-w-full max-h-full hidden rounded-md" controls autoplay></video>
    </div>
  </div>

  <script>
    // Basic lightbox (jak wyżej)
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modalImg');
    const modalVideo = document.getElementById('modalVideo');
    const modalClose = document.getElementById('modalClose');
    modalClose.addEventListener('click', () => {
      modal.classList.add('hidden'); modalVideo.pause();
    });
    modal.addEventListener('click', e => {
      if (e.target === modal) { modal.classList.add('hidden'); modalVideo.pause(); }
    });

    // Wczytanie wpisów
    async function loadEntries() {
      try {
        const data = await fetch('/api/entries').then(r => r.json());
        const container = document.getElementById('entries');
        container.innerHTML = '';

        data.forEach(item => {
          const card = document.createElement('div');
          card.className = 'bg-white p-4 rounded-lg shadow flex flex-col md:flex-row gap-4';

          // Media
          const mediaContainer = document.createElement('div');
          mediaContainer.className = 'w-full md:w-1/3';
          const isVideo = /\.(mp4|webm|ogg)$/i.test(item.mediaUrl);
          const el = document.createElement(isVideo ? 'video' : 'img');
          el.src = item.mediaUrl;
          el.className = 'w-full h-48 object-cover rounded-md cursor-pointer';
          if (isVideo) el.muted = true; else el.alt = 'Zdjęcie';
          el.addEventListener('click', () => {
            modalImg.classList.add('hidden');
            modalVideo.classList.add('hidden');
            if (isVideo) {
              modalVideo.src = item.mediaUrl;
              modalVideo.classList.remove('hidden');
            } else {
              modalImg.src = item.mediaUrl;
              modalImg.classList.remove('hidden');
            }
            modal.classList.remove('hidden');
          });
          mediaContainer.appendChild(el);

          // Tekst
          const textContainer = document.createElement('div');
          textContainer.className = 'w-full md:w-2/3';
          const name = document.createElement('h2');
          name.className = 'text-xl font-semibold';
          name.textContent = item.name;
          const time = document.createElement('p');
          time.className = 'text-gray-500 text-sm mb-2';
          time.textContent = new Date(item.timestamp).toLocaleString('pl-PL');
          const msg = document.createElement('p');
          msg.className = 'text-gray-800';
          msg.textContent = item.message;
          textContainer.append(name, time, msg);

          card.append(mediaContainer, textContainer);
          container.appendChild(card);
        });

      } catch (err) {
        console.error('Błąd ładowania wpisów:', err);
      }
    }

    window.addEventListener('load', loadEntries);
  </script>
</body>
</html>
